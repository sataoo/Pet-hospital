<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ledao.mapper.DiagnosisMapper">

    <resultMap id="DiagnosisResult" type="Diagnosis">
        <result property="id" column="id"/>
        <result property="createDate" column="createDate"/>
        <result property="description" column="description"/>
        <result property="status" column="status"/>
        <result property="price" column="price"/>
        <association property="customer" column="customerId" select="com.ledao.mapper.CustomerMapper.findById"></association>
        <association property="pet" column="petId" select="com.ledao.mapper.PetMapper.findById"></association>
        <association property="user" column="userId" select="com.ledao.mapper.UserMapper.findById"></association>
    </resultMap>
    <select id="list" parameterType="map" resultMap="DiagnosisResult">
        select * from t_diagnosis
        <where>
            <if test="customerId!=null">
                and customerId=#{customerId}
            </if>
            <if test="userId!=null">
                and userId=#{userId}
            </if>
            <if test="petId!=null">
                and petId=#{petId}
            </if>
            <if test="user!=null">
                and userId=#{user.id}
            </if>
            <if test="userId!=null">
                and userId=#{userId}
            </if>
            <if test="status!=null">
                and status=#{status}
            </if>
            <if test="price!=null">
                and price=#{price}
            </if>
            <if test="description!=null">
                and description=#{description}
            </if>
        </where>
            <if test="start!=null and size!=null">
                limit #{start},#{size}
            </if>
    </select>

    <select id="getCount" parameterType="map" resultType="java.lang.Long">
        select count(*) from t_diagnosis
        <where>
        <if test="customerId!=null">
            and customerId=#{customerId}
        </if>
        <if test="userId!=null">
            and userId=#{userId}
        </if>
        <if test="petId!=null">
            and petId=#{petId}
        </if>
        <if test="user!=null">
            and userId=#{user.id}
        </if>
        <if test="userId!=null">
            and userId=#{userId}
        </if>
        <if test="status!=null">
            and status=#{status}
        </if>
        <if test="price!=null">
            and price=#{price}
        </if>
        <if test="description!=null">
            and description=#{description}
        </if>
        </where>
    </select>
    <insert id="add" parameterType="Diagnosis">
        insert into t_diagnosis (customerId, petId, userId, createDate, description, status, price) values (#{customerId},#{petId}, #{user.id}, now(),#{description},0,#{price});
    </insert>
    <update id="update" parameterType="Diagnosis">
        update t_diagnosis
        <set>
            <if test="description != null and description != ''">
                description=#{description},
            </if>
            <if test="pet!=null">
                petId=#{pet.id},
            </if>
            <if test="status != null">
                status=#{status},
            </if>
            <if test="user != null">
                userId=#{user.id},
            </if>
            <if test="customer != null">
                customerId=#{customer.id},
            </if>
            <if test="price != null">
                price=#{price},
            </if>
        </set>
        where id=#{id}
    </update>
    <delete id="delete" parameterType="integer">
        delete from t_diagnosis where id=#{id}
    </delete>
    <select id="findById" parameterType="integer" resultMap="DiagnosisResult">
        select * from t_diagnosis where id=#{id}
    </select>

</mapper>